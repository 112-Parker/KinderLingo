<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KinderLingo</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üê§</text></svg>">
    
    <style>
        /* T·ªîNG TH·ªÇ */
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        /* L·ªöP N·ªÄN (BACKGROUND) - ƒê·∫∂T RI√äNG ƒê·ªÇ KH√îNG ƒê√à L√äN N√öT */
        .fixed-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('https://images.unsplash.com/photo-1503676260728-1c00da094a0b?q=80&w=1920');
            background-size: cover; background-position: center;
            z-index: -1; /* Lu√¥n ·ªü d∆∞·ªõi c√πng */
        }

        /* TRANG LOGIN */
        #login-page { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            background: rgba(0, 0, 0, 0.4); z-index: 9999; 
        }
        .login-box { 
            background: white; padding: 30px; border-radius: 20px; width: 300px; 
            text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        /* TRANG CH√çNH */
        #main-app { display: none; flex-direction: column; min-height: 100vh; position: relative; z-index: 10; }
        
        header { 
            background: rgba(255, 255, 255, 0.95); padding: 10px 5%; 
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); sticky; top: 0; z-index: 1000;
        }

        .container { display: flex; max-width: 1200px; margin: 20px auto; width: 95%; gap: 20px; }

        /* SIDEBAR - N∆†I B·ªä L·ªñI CLICK */
        .sidebar { 
            width: 220px; background: white; border-radius: 15px; padding: 15px; 
            height: fit-content; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            position: relative; z-index: 100; /* Nh·∫•c l√™n ƒë·ªÉ nh·∫•n ƒë∆∞·ª£c */
        }
        .menu-item { 
            padding: 12px; margin-bottom: 5px; cursor: pointer; border-radius: 8px; 
            font-weight: bold; transition: 0.3s; color: #444; border: 1px solid transparent;
        }
        .menu-item:hover { background: #f0f7ff; color: #2563eb; }
        .menu-item.active { background: #2563eb; color: white; }

        .main-content { 
            flex: 1; background: white; border-radius: 15px; padding: 25px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); z-index: 50;
        }

        /* LOGO NH√öN NH·∫¢Y */
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .bird { font-size: 40px; animation: bounce 2s infinite ease-in-out; display: inline-block; }

        .btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .btn-blue { background: #2563eb; color: white; width: 100%; }
        input, select { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .card { border: 1px solid #eee; padding: 15px; border-radius: 10px; margin-bottom: 15px; background: #fff; }
        .tab { display: none; }
        .tab.active { display: block; }
    </style>
</head>
<body>

    <div class="fixed-bg"></div>

    <div id="login-page">
        <div class="login-box">
            <div class="bird">üê§</div>
            <h2 style="margin:10px 0">KinderLingo</h2>
            <input type="text" id="user" placeholder="T√™n: admin">
            <input type="password" id="pass" placeholder="M·∫≠t kh·∫©u: 123">
            <button class="btn btn-blue" onclick="doLogin()">ƒêƒÉng nh·∫≠p</button>
        </div>
    </div>

    <div id="main-app">
        <header>
            <div style="font-weight:bold; font-size:20px; color:#2563eb">üê§ KinderLingo</div>
            <div style="flex:0 1 400px"><input type="text" id="find" placeholder="T√¨m b√†i h·ªçc..." onkeyup="search()" style="margin:0"></div>
            <button class="btn" style="background:#ffeded; color:red" onclick="location.reload()">Tho√°t</button>
        </header>

        <div class="container">
            <div class="sidebar">
                <div class="menu-item active" id="m-view" onclick="showTab('view')">üìö B√†i h·ªçc</div>
                <div class="menu-item" id="m-admin" onclick="showTab('admin')">üõ† Qu·∫£n l√Ω</div>
            </div>

            <div class="main-content">
                <div id="view" class="tab active"><div id="list"></div></div>
                <div id="admin" class="tab">
                    <h3>Th√™m b√†i m·ªõi</h3>
                    <select id="t" onchange="changeInput()">
                        <option value="v">Video YouTube</option>
                        <option value="p">File PDF</option>
                    </select>
                    <input type="text" id="title" placeholder="Ti√™u ƒë·ªÅ">
                    <input type="text" id="link" placeholder="D√°n link YouTube">
                    <input type="file" id="file" accept="application/pdf" style="display:none">
                    <button class="btn" style="background:#10b981; color:white; width:100%" onclick="save()">L∆∞u b√†i h·ªçc</button>
                </div>
            </div>
        </div>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const cfg = {
        apiKey: "AIzaSyCNxcMDCNliNsBgUTIvdEZGb-92c-L_3cs",
        authDomain: "kinderlingo-b9976.firebaseapp.com",
        databaseURL: "https://kinderlingo-b9976-default-rtdb.firebaseio.com/",
        projectId: "kinderlingo-b9976",
        storageBucket: "kinderlingo-b9976.firebasestorage.app",
        messagingSenderId: "946131764403",
        appId: "1:946131764403:web:5f1529ab8bfd70716b9cc6"
    };

    const app = initializeApp(cfg);
    const db = getDatabase(app);
    const r = ref(db, 'study_content');

    window.doLogin = () => {
        if(document.getElementById('user').value==='admin' && document.getElementById('pass').value==='123') {
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('main-app').style.display = 'flex';
            load();
        } else alert("Sai r·ªìi!");
    };

    window.showTab = (id) => {
        document.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
        document.querySelectorAll('.menu-item').forEach(x => x.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.getElementById('m-'+id).classList.add('active');
    };

    window.changeInput = () => {
        const p = document.getElementById('t').value === 'p';
        document.getElementById('link').style.display = p ? 'none' : 'block';
        document.getElementById('file').style.display = p ? 'block' : 'none';
    };

    window.save = async () => {
        const type = document.getElementById('t').value;
        const title = document.getElementById('title').value;
        if(!title) return alert("Nh·∫≠p t√™n!");
        let data = "";
        if(type==='v') {
            const l = document.getElementById('link').value;
            data = l.split('v=')[1]?.split('&')[0] || l.split('/').pop();
        } else {
            const f = document.getElementById('file').files[0];
            if(!f) return alert("Ch·ªçn file!");
            data = await new Promise(res => {
                const rd = new FileReader(); rd.onload = () => res(rd.result); rd.readAsDataURL(f);
            });
        }
        push(r, { type, title, data }).then(() => {
            alert("ƒê√£ xong!");
            document.getElementById('title').value = "";
            showTab('view');
        });
    };

    function load() {
        onValue(r, (s) => {
            const list = document.getElementById('list');
            list.innerHTML = "";
            const val = s.val();
            if(!val) return;
            const searchVal = document.getElementById('find').value.toLowerCase();
            Object.entries(val).reverse().forEach(([id, item]) => {
                if(!item.title.toLowerCase().includes(searchVal)) return;
                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `
                    <div style="display:flex; justify-content:space-between"><b>${item.title}</b><span onclick="del('${id}')" style="color:red; cursor:pointer">X√≥a</span></div>
                    ${item.type==='v' ? `<iframe style="width:100%; aspect-ratio:16/9; margin-top:10px" src="https://www.youtube.com/embed/${item.data}" frameborder="0"></iframe>` : 
                    `<button onclick="viewPDF('${id}')" style="margin-top:10px; width:100%; padding:10px; cursor:pointer">üìñ M·ªü PDF</button>`}
                `;
                list.appendChild(div);
            });
        });
    }

    window.del = (id) => confirm("X√≥a?") && remove(ref(db, 'study_content/'+id));
    window.viewPDF = (id) => {
        onValue(ref(db, 'study_content/'+id), (s) => {
            const item = s.val();
            const url = URL.createObjectURL(new Blob([new Uint8Array(atob(item.data.split(',')[1]).split('').map(c => c.charCodeAt(0)))], {type: 'application/pdf'}));
            window.open(url, '_blank');
        }, {onlyOnce: true});
    };
    window.search = load;
</script>
</body>
</html>
